# Build and push persistent-petitioner image to Docker Hub (jb6magic/persistent-petitioner).
# On push to main: tag sha-<short> + latest. On release: tag from release (e.g. v1.0.0 â†’ 1.0.0) + latest.
# Secrets: DOCKERHUB_USERNAME, DOCKERHUB_TOKEN.

name: Docker build and push

on:
  push:
    branches: [main]
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      image_tag:
        description: 'Override image tag (e.g. 1.0.0)'
        required: false

concurrency: docker-build-persistent-petitioner

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build and push
        uses: expectedbehaviors/github-actions/.github/actions/docker-publish@main
        with:
          image_name: persistent-petitioner
          repo_prefix: jb6magic
          docker_username: ${{ secrets.DOCKERHUB_USERNAME }}
          docker_token: ${{ secrets.DOCKERHUB_TOKEN }}
          dockerfile_path: deploy/docker/Dockerfile
          context: deploy/docker
          image_tag: ${{ github.event.inputs.image_tag }}
